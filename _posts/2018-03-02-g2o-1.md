---
layout: post
title: Graph Optimization Modelling
description: "Graph Optimization"
tags: [SLAM Optimization]
categories: [SLAM, Optimization]
---

* TOC
{:toc}

<!-- more -->

## How to model the world

### What the vertices and edges really mean in graph based SLAM?

The graph optimization's essential idea is modeling the SLAM problem as a graph. The tutorials usually say that the camera's poses are modeled as a vertex in graph, the edge connecting two vertices represents a constraint. Which somewhat simplifies the problem and makes the reader confusing.

Because, **not only the camera poses can be modeled as vertices, but also 3D landmarks.** Constraint is a concept usually used in optimization, for some one who is not familiar with optimization, the edges just represent some physical relationships.

### What is edge and vertex in Graph Optimization


![g2o_edge_vertex]({{ site.url }}\images\SLAM\g2o\g2o_edge_vertex.png)

Let us take the above graph as an example, it is actually bundle adjustment represented in the form of a graph.


#### Vertex

Sometimes it is also called node in graph optimization. In this graph, we can see two kinds of vertices.

##### Camera Pose Vertices

The cyan vertices represent the camera poses. Even for camera poses, it can also be modeled in many ways according to our needs. For the above case, the camera poses are modelled as  in the form of $$R,t$$ as 3x3 rotation matrix and 3x1 translation vector respectively. In some cases when we only care about location, the camera pose vertices can also be modelled as 3D position as $$(x,y,z)$$. When dealing with robot moving indoor, they can even be modelled as 2D position as $$(x,y)$$ by ignoring the vertical position change.

##### Landmark Vertices

The orange vertices represent the landmarks. In the case of the above graph, landmarks are modelled as 3D points as $$(x,y,z)$$. Similar to camera poses, the landmark vertices can also be modelled differently according to the requirements. If we ignore the vertical direction for indoor robot, landmark also turns to be 2D positions as $$(x,y)$$. 

##### Visualization convention: should the vertices aligned along a line?

In the field of robotics, people usually visualize the vertices like the physical position of the camera, but for the people that are familiar with probabilistic models, they may visualize the nodes on a straight line. They are theoretically the same. 

#### Edges

Usually edges are considered as "constrains" in graph optimization. Practically, it can model different physical relationships between vertices, the constrains can be explained as "estimation targets constrained by real measurements". So **the edge of the graph always means some kinds of "measurement"**.

##### Edge between Camera Pose

In some tutorials, the edges between camera poses are usually described as odometry constrains from visual odometry or IMU odometry data. **Actually, they are not always needed.** For example, in the case of bundle adjustment, we have no measurements between two camera poses, so we don't have them. The graph turns to be:

![g2o_edge_vertex_noedge]({{ site.url }}\images\SLAM\g2o\g2o_edge_vertex_noedge.png)

##### Edges between landmarks and camera poses

The edges between landmarks and camera poses represent the $$3D\rightarrow 2D$$ projection as a measurement method, **the landmark at position $$Z_{ij}$$ is projected to the image pixel $$x_{ij}$$ by the camera positioned and oriented at $$X_i$$.** **The pixel position $$x_{ij}$$ is then the measurement.** 

Now we can see that **there is always some measurement hidden in the edge connecting two vertices.**

For bundle adjustment, we get image pixels as measurements. The position of our estimation targets, our unknown landmarks and camera poses are constrained by the measurements. **The real positions of the landmarks and the cameras must follow the physical rule to give us the measurements we get.**

## How to model the SLAM problem

### What do we have

### What do we want to get














